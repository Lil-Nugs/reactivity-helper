{"id":"reactivity-helper-1e9","title":"Fix IncidentList to use database-level pagination","description":"Performance issue - loads all incidents into memory, then slices for display.\n\n## Current State\n\nIncidentList.tsx:26-30 loads ALL incidents, then slices in JavaScript:\n```typescript\nconst { incidents: allIncidents, isLoading } = useIncidents(dogId)\nconst visibleIncidents = allIncidents.slice(0, visibleCount)\n```\n\n## Hook Already Supports Pagination\n\nuseIncidents hook (src/hooks/useIncidents.ts:6-9) already has limit/offset options:\n```typescript\ninterface UseIncidentsOptions {\n  limit?: number\n  offset?: number\n}\n```\n\n## Implementation\n\nChange IncidentList.tsx to use database-level pagination:\n\n```typescript\n// Replace lines 21-30:\nconst [visibleCount, setVisibleCount] = useState(20)\nconst [loadedIncidents, setLoadedIncidents] = useState\u003cIncident[]\u003e([])\nconst [hasMore, setHasMore] = useState(true)\n\n// Use hook with limit\nconst { incidents, isLoading: isLoadingIncidents } = useIncidents(dogId, { \n  limit: visibleCount \n})\n\n// Update scroll handler (lines 40-51):\nconst handleScroll = () =\u003e {\n  const { scrollTop, scrollHeight, clientHeight } = container\n  const scrolledToBottom = scrollTop + clientHeight \u003e= scrollHeight - 100\n\n  if (scrolledToBottom \u0026\u0026 !isLoadingMore \u0026\u0026 hasMore) {\n    setIsLoadingMore(true)\n    // Keep 300ms delay for smooth UX (prevents jarring content shift)\n    setTimeout(() =\u003e {\n      setVisibleCount((prev) =\u003e prev + 20)\n      setIsLoadingMore(false)\n    }, 300)\n  }\n}\n\n// Update end-of-list check (line 126):\n// hasMore is false when incidents.length \u003c visibleCount\n```\n\n## Key Decisions\n\n1. **Offset-based pagination** (not cursor-based). The useIncidents hook uses limit/offset which is simpler and sufficient for this use case.\n\n2. **Keep 300ms delay**: The artificial delay provides smooth UX and prevents jarring content shifts. This is intentional.\n\n3. **Detect end of list**: When `incidents.length \u003c visibleCount`, we've reached the end.\n\n4. **No true offset tracking needed**: Since we're increasing limit (not sliding a window), offset stays at 0. We just ask for \"first N\" where N grows.\n\n## Files to modify\n1. `src/components/Reactivity/History/IncidentList.tsx` - use limit option in useIncidents call\n\n## Testing\n1. Create 50+ incidents\n2. Scroll to bottom\n3. Verify additional incidents load without fetching ALL incidents\n4. Check browser devtools IndexedDB queries (should use limit)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T23:57:46.820932919-08:00","created_by":"mattc","updated_at":"2026-01-06T19:18:58.762327101-08:00"}
{"id":"reactivity-helper-1mt","title":"Add ErrorBoundary wrapper to prevent app crashes","description":"Any component error crashes the entire app. Add ErrorBoundary wrapper to prevent full app crashes.\n\n## Implementation\n\n### 1. Create ErrorBoundary component\n\nCreate `src/components/common/ErrorBoundary.tsx`:\n\n```typescript\nimport { Component, type ReactNode } from 'react';\n\ninterface Props {\n  children: ReactNode;\n  fallback?: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n  error?: Error;\n}\n\n/**\n * Error boundary to catch React component errors and display fallback UI.\n * Prevents single component errors from crashing the entire app.\n */\nexport class ErrorBoundary extends Component\u003cProps, State\u003e {\n  constructor(props: Props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error): State {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    // Log error to console for debugging\n    console.error('[ErrorBoundary] Caught error:', error, errorInfo.componentStack);\n  }\n\n  handleReload = () =\u003e {\n    window.location.reload();\n  };\n\n  handleGoHome = () =\u003e {\n    window.location.href = '/';\n  };\n\n  render() {\n    if (this.state.hasError) {\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n\n      // Default fallback UI - matches app styling\n      return (\n        \u003cdiv className=\"min-h-screen flex items-center justify-center bg-gray-50 p-4\"\u003e\n          \u003cdiv className=\"text-center max-w-md\"\u003e\n            \u003cdiv className=\"text-6xl mb-4\"\u003eüòµ\u003c/div\u003e\n            \u003ch1 className=\"text-xl font-bold text-gray-900 mb-2\"\u003e\n              Something went wrong\n            \u003c/h1\u003e\n            \u003cp className=\"text-gray-600 mb-6\"\u003e\n              The app encountered an unexpected error. Your data is safe.\n            \u003c/p\u003e\n            \u003cdiv className=\"space-y-3\"\u003e\n              \u003cbutton\n                onClick={this.handleReload}\n                className=\"w-full min-h-11 bg-indigo-600 text-white font-semibold rounded-lg active:bg-indigo-700\"\n              \u003e\n                Reload App\n              \u003c/button\u003e\n              \u003cbutton\n                onClick={this.handleGoHome}\n                className=\"w-full min-h-11 bg-white text-gray-700 font-medium rounded-lg border border-gray-300 active:bg-gray-50\"\n              \u003e\n                Go to Home\n              \u003c/button\u003e\n            \u003c/div\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      );\n    }\n\n    return this.props.children;\n  }\n}\n```\n\n### 2. Wrap App.tsx\n\nIn `src/App.tsx`, wrap DogProvider with ErrorBoundary:\n\n```typescript\nimport { ErrorBoundary } from './components/common/ErrorBoundary';\n\nfunction App() {\n  return (\n    \u003cBrowserRouter basename={import.meta.env.BASE_URL}\u003e\n      \u003cErrorBoundary\u003e\n        \u003cDogProvider\u003e\n          \u003cRoutes\u003e\n            {/* routes */}\n          \u003c/Routes\u003e\n        \u003c/DogProvider\u003e\n      \u003c/ErrorBoundary\u003e\n    \u003c/BrowserRouter\u003e\n  );\n}\n```\n\n## Key Decisions\n\n1. **Custom class component** - No external library needed. react-error-boundary adds unnecessary dependency for simple use case.\n\n2. **Fallback UI**: Centered error message with emoji, matching existing app styling (gray-50 bg, indigo-600 buttons, min-h-11 touch targets).\n\n3. **Recovery options**: \n   - \"Reload App\" (primary) - window.location.reload()\n   - \"Go to Home\" (secondary) - navigate to root\n   \n4. **Error logging**: Console.error only. No remote logging for v1 (offline-first app).\n\n5. **Boundary scope**: Single app-level boundary wrapping DogProvider. Module-level boundaries can be added later if needed.\n\n6. **Styling**: Uses Tailwind classes consistent with ModuleSelector error state.\n\n## Files to modify\n1. Create `src/components/common/ErrorBoundary.tsx`\n2. Update `src/App.tsx` - import and wrap DogProvider\n3. Update `src/components/common/index.ts` - export ErrorBoundary","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-04T23:57:38.604656067-08:00","created_by":"mattc","updated_at":"2026-01-06T19:18:06.408864343-08:00"}
{"id":"reactivity-helper-2vt","title":"Dexie database setup with all tables","description":"Set up Dexie.js for IndexedDB storage with all required tables.\n\nFile: src/db/index.ts\n\nTables needed:\n- dogs (id, name)\n- userSettings (id, activeDogId, recentTags, darkMode)\n- namedLocations (id, dogId, name, lat, lng, radiusMeters)\n- incidents (id, dogId, timestamp, trigger, intensity, + optional fields)\n- departures (id, dogId, timestamp, duration, exitType, outcome, + optional fields)\n- weeklyTargets (id, dogId, weekStart, targetDuration, notes)\n- medicationConfigs (id, dogId, name, doses, notes)\n- medicationEntries (id, dogId, date, medicationId, doseScheduleId, targetTime, actualTime, dose)\n\nIndex configuration:\n- incidents: [dogId, timestamp]\n- departures: [dogId, timestamp]\n- medicationEntries: [dogId, date, medicationId]\n\nAcceptance criteria:\n- Dexie database initializes correctly\n- All tables are queryable\n- Indexes work for common queries","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T22:30:21.441606-08:00","updated_at":"2025-12-25T23:46:08.715037-08:00","closed_at":"2025-12-25T23:46:08.715037-08:00","close_reason":"Dexie database setup complete with all 8 tables, compound indexes, and helper functions","dependencies":[{"issue_id":"reactivity-helper-2vt","depends_on_id":"reactivity-helper-oqs","type":"blocks","created_at":"2025-12-25T22:30:54.264254-08:00","created_by":"daemon"},{"issue_id":"reactivity-helper-2vt","depends_on_id":"reactivity-helper-a46","type":"parent-child","created_at":"2025-12-25T22:34:50.372669-08:00","created_by":"daemon"}]}
{"id":"reactivity-helper-4h0","title":"Remove Example.tsx and add loading skeletons","description":"Cleanup tasks: remove unused component and add loading skeletons.\n\n## Task 1: Delete Example.tsx\n\nDelete `src/components/common/Example.tsx` - it's a development example, not needed in production.\n\nAlso remove from `src/components/common/index.ts` if exported there.\n\n## Task 2: Add Loading Skeletons\n\nReplace plain \"Loading...\" text in IncidentList.tsx:68-74 with skeleton cards.\n\n### Create SkeletonCard component\n\nAdd to `src/components/Reactivity/History/SkeletonCard.tsx`:\n\n```typescript\n/**\n * Skeleton placeholder for IncidentCard during loading.\n * Matches IncidentCard dimensions for seamless transition.\n */\nexport function SkeletonCard() {\n  return (\n    \u003cdiv className=\"bg-white rounded-lg shadow-sm p-4 animate-pulse\"\u003e\n      {/* Top row: trigger icon + time */}\n      \u003cdiv className=\"flex items-center justify-between mb-3\"\u003e\n        \u003cdiv className=\"flex items-center gap-3\"\u003e\n          \u003cdiv className=\"w-10 h-10 bg-gray-200 rounded-full\" /\u003e\n          \u003cdiv className=\"w-24 h-4 bg-gray-200 rounded\" /\u003e\n        \u003c/div\u003e\n        \u003cdiv className=\"w-16 h-4 bg-gray-200 rounded\" /\u003e\n      \u003c/div\u003e\n      {/* Bottom row: intensity bar */}\n      \u003cdiv className=\"w-full h-2 bg-gray-200 rounded-full\" /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Update IncidentList loading state\n\nReplace lines 68-74:\n```typescript\n// Loading state (initial load)\nif (isLoadingIncidents) {\n  return (\n    \u003cdiv className=\"px-4 py-4 space-y-3\"\u003e\n      {[...Array(5)].map((_, i) =\u003e (\n        \u003cSkeletonCard key={i} /\u003e\n      ))}\n    \u003c/div\u003e\n  );\n}\n```\n\n## Key Decisions\n\n1. **5 skeleton items**: Standard UX pattern for initial loading. Not too few (looks empty), not too many (misleading).\n\n2. **animate-pulse**: Tailwind's built-in pulse animation. Subtle breathing effect.\n\n3. **Match IncidentCard dimensions**: Same padding (p-4), border-radius (rounded-lg), and approximate content layout.\n\n4. **Gray-200 for placeholders**: Consistent with Tailwind's skeleton patterns.\n\n5. **Separate component**: SkeletonCard is its own file for reusability (could be used in other lists).\n\n## Files to modify\n1. Delete `src/components/common/Example.tsx`\n2. Update `src/components/common/index.ts` - remove Example export if present\n3. Create `src/components/Reactivity/History/SkeletonCard.tsx`\n4. Update `src/components/Reactivity/History/IncidentList.tsx` - import SkeletonCard, update loading state\n5. Update `src/components/Reactivity/History/index.ts` - export SkeletonCard","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-04T23:57:54.103487828-08:00","created_by":"mattc","updated_at":"2026-01-06T19:20:14.215969533-08:00"}
{"id":"reactivity-helper-5y9","title":"Add offline indicator UI","description":"Users should know when the app is offline. Currently no visual indicator.\n\n## Implementation\n\n### 1. Create useOnlineStatus hook\n\nCreate `src/hooks/useOnlineStatus.ts`:\n\n```typescript\nimport { useState, useEffect } from 'react';\n\n/**\n * Hook to track browser online/offline status.\n * Uses navigator.onLine and 'online'/'offline' events.\n * \n * @returns true if online, false if offline\n */\nexport function useOnlineStatus(): boolean {\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n\n  useEffect(() =\u003e {\n    const handleOnline = () =\u003e setIsOnline(true);\n    const handleOffline = () =\u003e setIsOnline(false);\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () =\u003e {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  return isOnline;\n}\n```\n\n### 2. Add indicator to Header component\n\nUpdate `src/components/common/Header.tsx`:\n\n```typescript\nimport { ArrowLeft, Settings, WifiOff } from 'lucide-react';\nimport { useOnlineStatus } from '../../hooks/useOnlineStatus';\n\nexport function Header({ ... }) {\n  const isOnline = useOnlineStatus();\n\n  return (\n    \u003cheader ...\u003e\n      \u003cdiv className=\"flex items-center justify-between px-4 h-14\"\u003e\n        {/* Back Button */}\n        ...\n\n        {/* Title + Offline indicator */}\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          {!isOnline \u0026\u0026 (\n            \u003cWifiOff className=\"w-4 h-4 text-gray-400\" aria-label=\"Offline\" /\u003e\n          )}\n          \u003ch1 className=\"text-lg font-semibold text-gray-900 truncate\"\u003e\n            {title}\n          \u003c/h1\u003e\n        \u003c/div\u003e\n\n        {/* Settings Button */}\n        ...\n      \u003c/div\u003e\n    \u003c/header\u003e\n  );\n}\n```\n\n## Key Decisions\n\n1. **Icon in header** (not banner): Subtle, doesn't consume vertical space, always visible. Uses lucide-react WifiOff icon already available.\n\n2. **Styling**: Gray-400 (muted, not alarming). This is informational, not an error - the app works fully offline.\n\n3. **No \"Back online\" toast**: Disappear silently when connection returns. Users don't need celebration for returning to normal state.\n\n4. **Position**: Next to title in center of header. Visible but not prominent.\n\n5. **Event-based**: Uses 'online'/'offline' window events for instant detection (no polling).\n\n## Notes\n\n- This is informational only - the app is fully functional offline via Dexie/IndexedDB\n- navigator.onLine can have false positives (connected to network but no internet)\n- For v1, simple detection is sufficient\n\n## Files to modify\n1. Create `src/hooks/useOnlineStatus.ts`\n2. Update `src/components/common/Header.tsx` - add offline icon\n3. Update `src/hooks/index.ts` - export useOnlineStatus","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-04T23:57:51.836436776-08:00","created_by":"mattc","updated_at":"2026-01-06T19:19:46.013691059-08:00"}
{"id":"reactivity-helper-6pf","title":"Extract duplicate Haversine calculation to utils/geo.ts","description":"Code duplication - identical calculateDistance() function exists in two places.\n\n## Duplicate Locations\n\n1. `src/db/index.ts:206-224` - private function\n2. `src/hooks/useNamedLocations.ts:101-119` - private function\n\nBoth are identical Haversine formula implementations.\n\n## Implementation\n\n### 1. Create utils/geo.ts\n\n```typescript\n/**\n * Geographic utility functions for distance calculations.\n * Uses the Haversine formula for great-circle distance.\n */\n\n/**\n * Calculate distance between two GPS coordinates using Haversine formula.\n * \n * @param lat1 - Latitude of first point (degrees)\n * @param lng1 - Longitude of first point (degrees)\n * @param lat2 - Latitude of second point (degrees)\n * @param lng2 - Longitude of second point (degrees)\n * @returns Distance in meters\n * \n * @example\n * const distance = calculateDistance(37.7749, -122.4194, 37.3382, -121.8863);\n * console.log(distance); // ~67km between SF and San Jose\n */\nexport function calculateDistance(\n  lat1: number,\n  lng1: number,\n  lat2: number,\n  lng2: number\n): number {\n  const R = 6371e3; // Earth's radius in meters\n  const œÜ1 = (lat1 * Math.PI) / 180;\n  const œÜ2 = (lat2 * Math.PI) / 180;\n  const ŒîœÜ = ((lat2 - lat1) * Math.PI) / 180;\n  const ŒîŒª = ((lng2 - lng1) * Math.PI) / 180;\n\n  const a =\n    Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +\n    Math.cos(œÜ1) * Math.cos(œÜ2) * Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n  return R * c;\n}\n```\n\n### 2. Update imports\n\nIn `src/db/index.ts`:\n```typescript\nimport { calculateDistance } from '../utils/geo';\n// Remove local calculateDistance function (lines 206-224)\n```\n\nIn `src/hooks/useNamedLocations.ts`:\n```typescript\nimport { calculateDistance } from '../utils/geo';\n// Remove local calculateDistance function (lines 101-119)\n```\n\n## Key Decisions\n\n1. **Same signature**: Keep identical function signature. No breaking changes.\n\n2. **JSDoc with units**: Add clear documentation specifying:\n   - Input: degrees (not radians)\n   - Output: meters (not km)\n   - Include usage example\n\n3. **No unit tests for v1**: Function is mathematically proven (Haversine). Tests can be added later if edge cases emerge. The formula handles:\n   - Same point (returns 0)\n   - Antipodal points (returns ~20,000km)\n   - Cross-dateline correctly\n\n4. **Single-purpose file**: Only calculateDistance for now. Other geo utilities (bearing, polygon containment) can be added when needed. Don't over-engineer.\n\n## Files to modify\n1. Create `src/utils/geo.ts`\n2. Update `src/db/index.ts` - import from utils, delete local function\n3. Update `src/hooks/useNamedLocations.ts` - import from utils, delete local function","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T23:57:43.438483262-08:00","created_by":"mattc","updated_at":"2026-01-06T19:19:43.94834744-08:00"}
{"id":"reactivity-helper-6ru","title":"Module selector home screen","description":"Create the home screen with module selection cards per DESIGN.md UI mockup.\n\nFile: src/components/Home/ModuleSelector.tsx\n\nUI requirements:\n- App title: 'Reactivity Helper' with dog emoji\n- Three module cards in vertical stack:\n  1. Reactivity (üö∂) - 'Log reactive incidents'\n  2. Separation Anxiety (üè†) - 'Log departures'\n  3. Medications (üíä) - 'Log doses'\n- Cards are tappable, navigate to respective module\n- Mobile-first styling with proper touch targets\n\nFirst-run experience:\n- If no dog exists, show 'What's your dog's name?' prompt\n- Create dog record on submission\n- Store activeDogId in userSettings\n\nAcceptance criteria:\n- Home screen displays correctly\n- Module cards navigate to correct routes\n- First-run flow creates dog + settings","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T22:30:22.700114-08:00","updated_at":"2025-12-26T11:22:10.457061-08:00","closed_at":"2025-12-26T11:22:10.457061-08:00","close_reason":"Closed","dependencies":[{"issue_id":"reactivity-helper-6ru","depends_on_id":"reactivity-helper-qlk","type":"blocks","created_at":"2025-12-25T22:30:55.276722-08:00","created_by":"daemon"},{"issue_id":"reactivity-helper-6ru","depends_on_id":"reactivity-helper-2vt","type":"blocks","created_at":"2025-12-25T22:30:55.796356-08:00","created_by":"daemon"},{"issue_id":"reactivity-helper-6ru","depends_on_id":"reactivity-helper-a46","type":"parent-child","created_at":"2025-12-25T22:34:57.087632-08:00","created_by":"daemon"}]}
{"id":"reactivity-helper-7t9","title":"PWA configuration with vite-plugin-pwa","description":"Configure PWA functionality using vite-plugin-pwa for offline-first experience.\n\nRequirements per DESIGN.md:\n- Install and configure vite-plugin-pwa\n- Manifest: name='Reactivity Helper', short_name='ReactHelper', theme_color='#4F46E5', display='standalone'\n- Service worker with cache-first strategy\n- App icons (192x192, 512x512)\n- Workbox runtime caching configuration\n\niOS-specific:\n- apple-touch-icon link\n- apple-mobile-web-app-status-bar-style meta tag\n\nAcceptance criteria:\n- PWA installs correctly on iOS/Android\n- App works offline after first load\n- Service worker registers successfully","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T22:30:20.11092-08:00","updated_at":"2025-12-25T23:17:11.984881-08:00","closed_at":"2025-12-25T23:17:11.984881-08:00","close_reason":"Closed","dependencies":[{"issue_id":"reactivity-helper-7t9","depends_on_id":"reactivity-helper-8ju","type":"blocks","created_at":"2025-12-25T22:30:53.208005-08:00","created_by":"daemon"},{"issue_id":"reactivity-helper-7t9","depends_on_id":"reactivity-helper-a46","type":"parent-child","created_at":"2025-12-25T22:34:49.26418-08:00","created_by":"daemon"}]}
{"id":"reactivity-helper-8ju","title":"Project scaffolding: Vite + React + TypeScript + Tailwind","description":"Set up the foundational project structure with Vite, React 18, TypeScript, and Tailwind CSS. This is the base that all other work depends on.\n\nRequirements:\n- Vite with React + TypeScript template\n- Tailwind CSS with mobile-first configuration\n- Basic folder structure per DESIGN.md (src/components, src/hooks, src/db, src/types)\n- ESLint + Prettier configuration\n- Base HTML with iOS meta tags (viewport-fit=cover, apple-mobile-web-app-capable)\n\nAcceptance criteria:\n- npm run dev starts the dev server\n- TypeScript compilation works\n- Tailwind utility classes are applied correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T22:30:13.779264-08:00","updated_at":"2025-12-25T22:53:24.391907-08:00","closed_at":"2025-12-25T22:53:24.391907-08:00","close_reason":"Project scaffolding complete with Vite, React 18, TypeScript, Tailwind CSS v4, ESLint, and Prettier","dependencies":[{"issue_id":"reactivity-helper-8ju","depends_on_id":"reactivity-helper-a46","type":"parent-child","created_at":"2025-12-25T22:34:48.669213-08:00","created_by":"daemon"}]}
{"id":"reactivity-helper-a46","title":"Phase 1: Foundation + Reactivity MVP","description":"Foundation setup and minimum viable Reactivity module per DESIGN.md.\n\nDeliverables:\n- Project scaffolding (Vite, React, TypeScript, Tailwind)\n- PWA configuration (offline-first)\n- Full data model types\n- Dexie database with all tables\n- Common navigation components\n- Module selector home screen\n- Reactivity Quick Log (3-tap logging)\n- Reactivity History list\n\nExit criteria:\n- App installs as PWA on iOS/Android\n- Can log reactivity incidents in 3 taps\n- Can view incident history\n- Works fully offline","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-25T22:33:21.192238-08:00","updated_at":"2026-01-06T19:20:35.944961368-08:00","closed_at":"2026-01-06T19:20:35.944961368-08:00","close_reason":"All deliverables complete:\n‚úÖ Project scaffolding (Vite, React, TypeScript, Tailwind)\n‚úÖ PWA configuration (offline-first via vite-plugin-pwa)\n‚úÖ Full data model types (src/types/)\n‚úÖ Dexie database with all tables (src/db/)\n‚úÖ Common navigation components (Header, BottomNav)\n‚úÖ Module selector home screen\n‚úÖ Reactivity Quick Log (3-tap logging)\n‚úÖ Reactivity History list\n\nExit criteria verified:\n‚úÖ App installs as PWA on iOS/Android\n‚úÖ Can log reactivity incidents in 3 taps\n‚úÖ Can view incident history\n‚úÖ Works fully offline\n\nAll 8 child tasks closed. TriggerGrid blocker (icu) resolved 2026-01-04."}
{"id":"reactivity-helper-asf","title":"Replace alert() with toast notifications","description":"Poor mobile UX - modal dialogs are intrusive on mobile.\n\n## Implementation Details\n\n### Library\nUse **react-hot-toast** - lightweight (~5KB gzipped), accessible, mobile-friendly.\n\n```bash\nnpm install react-hot-toast\n```\n\n### Setup\nAdd `\u003cToaster /\u003e` to App.tsx **inside BrowserRouter, after the closing `\u003c/DogProvider\u003e` tag**:\n\n```typescript\nimport { Toaster } from 'react-hot-toast';\n\n// In App component return:\n\u003cBrowserRouter basename={import.meta.env.BASE_URL}\u003e\n  \u003cDogProvider\u003e\n    \u003cRoutes\u003e\n      {/* routes */}\n    \u003c/Routes\u003e\n  \u003c/DogProvider\u003e\n  \u003cToaster \n    position=\"bottom-center\"\n    toastOptions={{\n      duration: 4000,\n      style: {\n        background: '#1f2937', // gray-800\n        color: '#f9fafb',      // gray-50\n        padding: '12px 16px',\n        borderRadius: '8px',\n      },\n      error: {\n        iconTheme: { primary: '#ef4444', secondary: '#f9fafb' },\n      },\n    }}\n    containerStyle={{\n      bottom: 80, // Above BottomNav (h-16 + padding)\n    }}\n  /\u003e\n\u003c/BrowserRouter\u003e\n```\n\n### Replace alert() in QuickLogScreen.tsx:86\n```typescript\nimport toast from 'react-hot-toast';\n\n// Replace:\nalert('Failed to log incident. Please try again.');\n\n// With:\ntoast.error('Failed to log incident. Please try again.');\n```\n\n### Scope\nThis is the **only** alert() in the codebase (verified). No other replacements needed.\n\n### Notes\n- Position: bottom-center with 80px offset (above BottomNav, thumb-reachable)\n- Duration: 4 seconds (enough to read, auto-dismisses)\n- Success toasts: NOT needed - button already shows \"Logged!\" state for 1.5s\n- Dark theme styling matches app aesthetic (gray-800 bg, gray-50 text)\n- Max toasts: default (no limit needed for single error toast)\n\n## Files to modify\n1. `package.json` - add react-hot-toast dependency\n2. `src/App.tsx` - add Toaster component after DogProvider, inside BrowserRouter\n3. `src/components/Reactivity/QuickLog/QuickLogScreen.tsx` - replace alert with toast.error\n\n## Testing\n1. Disconnect network or mock db failure\n2. Try to log an incident\n3. Verify toast appears above bottom nav, dismisses after 4s\n4. Verify toast doesn't block interaction","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-04T23:57:41.826217843-08:00","created_by":"mattc","updated_at":"2026-01-06T19:18:01.660320241-08:00"}
{"id":"reactivity-helper-axa","title":"Reactivity Quick Log screen","description":"Implement the primary Quick Log interface for reactivity incidents per DESIGN.md.\n\nFile: src/components/Reactivity/QuickLog/\n\nComponents needed:\n1. TriggerGrid.tsx - 6 trigger buttons (Dog, Person, Bike, Car, Noise, Other)\n2. IntensitySlider.tsx - 1-5 intensity selector with labels\n3. QuickLogScreen.tsx - Main screen composing the above\n\nFlow (3 taps):\n1. Tap trigger (required) - captures timestamp + GPS\n2. Tap intensity (required)\n3. Tap 'LOG IT' button\n\nData handling:\n- Use nanoid() for incident ID\n- Capture timestamp as ISO 8601\n- Attempt geolocation capture (optional, fail gracefully)\n- Save to Dexie incidents table\n\nUI requirements:\n- Touch-friendly buttons (min-h-11)\n- Visual feedback on selection\n- Success toast/feedback on log\n\nNote: Details expander (behaviors, notes) is Phase 2\n\nAcceptance criteria:\n- Can log incident in 3 taps\n- Incident saved to IndexedDB\n- Works without location permission","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T22:30:23.355363-08:00","updated_at":"2025-12-26T11:22:10.461347-08:00","closed_at":"2025-12-26T11:22:10.461347-08:00","close_reason":"Closed","dependencies":[{"issue_id":"reactivity-helper-axa","depends_on_id":"reactivity-helper-2vt","type":"blocks","created_at":"2025-12-25T22:30:56.289018-08:00","created_by":"daemon"},{"issue_id":"reactivity-helper-axa","depends_on_id":"reactivity-helper-qlk","type":"blocks","created_at":"2025-12-25T22:30:56.77052-08:00","created_by":"daemon"},{"issue_id":"reactivity-helper-axa","depends_on_id":"reactivity-helper-a46","type":"parent-child","created_at":"2025-12-25T22:34:51.931942-08:00","created_by":"daemon"}]}
{"id":"reactivity-helper-bs7","title":"Add navigator.storage.persist() for iOS data retention","description":"On iOS Safari, IndexedDB data may be evicted under storage pressure without persistence request.\n\n## Implementation\n\nAdd to `src/main.tsx` **before** the createRoot call:\n\n```typescript\nimport { StrictMode } from 'react'\nimport { createRoot } from 'react-dom/client'\nimport './index.css'\nimport App from './App.tsx'\n\n// Request persistent storage for iOS data retention\n// Must be called before any IndexedDB operations (Dexie init happens on first component mount)\nif (navigator.storage?.persist) {\n  navigator.storage.persist()\n    .then(granted =\u003e {\n      if (granted) {\n        console.log('[PWA] Persistent storage granted');\n      } else {\n        console.log('[PWA] Persistent storage denied - data may be evicted under pressure');\n      }\n    })\n    .catch(err =\u003e {\n      console.warn('[PWA] Storage persistence check failed:', err);\n    });\n}\n\ncreateRoot(document.getElementById('root')!).render(\n  \u003cStrictMode\u003e\n    \u003cApp /\u003e\n  \u003c/StrictMode\u003e,\n)\n```\n\n## Key Decisions\n\n1. **Timing**: Call before createRoot() to ensure it runs before any Dexie operations. The db singleton in `src/db/index.ts` is instantiated when first imported by DogProvider.\n\n2. **Error handling**: Use Promise chain with .catch() - non-blocking, won't crash app if API unavailable.\n\n3. **Logging**: Log result to console for debugging data retention issues. No user-facing feedback needed for v1.\n\n4. **Fallback**: App proceeds normally if persist() fails or is unavailable - this is an enhancement, not a requirement.\n\n## Notes\n- navigator.storage.persist() is a \"best effort\" API - browsers may still evict data\n- iOS Safari requires user engagement before granting persistence\n- Reference: DESIGN.md line 1030","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-04T23:57:40.054140122-08:00","created_by":"mattc","updated_at":"2026-01-06T19:18:04.246791514-08:00"}
{"id":"reactivity-helper-dsa","title":"Fix ModuleSelector safe area handling","description":"On notched iPhones, header content may overlap with status bar.\n\n## Problem\n\nModuleSelector.tsx:193 uses `pt-safe` class which is not defined in Tailwind config. The class has no effect.\n\n## Solution\n\nReplace `pt-safe` with inline style matching Header.tsx pattern:\n\n```tsx\n// Line 193 - Change from:\n\u003cheader className=\"bg-white shadow-sm pt-safe\"\u003e\n\n// To:\n\u003cheader \n  className=\"bg-white shadow-sm\"\n  style={{ paddingTop: 'env(safe-area-inset-top)' }}\n\u003e\n```\n\n## Verification\n\n‚úÖ `viewport-fit=cover` is already set in index.html:5 - required for env() to work\n‚úÖ Header.tsx already uses this pattern correctly (line 25-27)\n‚úÖ This is the only file with `pt-safe` (ModuleSelector has its own header, doesn't use Header component)\n\n## Scope\n\nThis fix only affects ModuleSelector's custom header. Other screens use the shared Header component which handles safe areas correctly.\n\n## Files to modify\n1. `src/components/Home/ModuleSelector.tsx` - line 193","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-04T23:57:48.686427619-08:00","created_by":"mattc","updated_at":"2026-01-06T19:18:53.800754973-08:00"}
{"id":"reactivity-helper-hyk","title":"Reactivity History list screen","description":"Implement basic history list for viewing logged incidents per DESIGN.md.\n\nFile: src/components/Reactivity/History/\n\nComponents needed:\n1. IncidentCard.tsx - Single incident display card\n   - Trigger emoji + name\n   - Intensity indicator (numbered circle)\n   - Time (formatted)\n   - Location name if available\n   - Behaviors list if present\n2. IncidentList.tsx - Scrollable list with date grouping\n\nUI requirements:\n- Grouped by date (Today, Yesterday, Dec 23, etc.)\n- Chronological order (newest first)\n- Infinite scroll pagination (20 items initial, load more on scroll)\n- Empty state: 'No incidents logged yet...'\n\nData fetching:\n- Query Dexie incidents table\n- Filter by dogId\n- Order by timestamp descending\n\nNote: Filters and edit/delete are Phase 2\n\nAcceptance criteria:\n- List displays logged incidents correctly\n- Date grouping works\n- Infinite scroll loads more items\n- Empty state shows when no data","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T22:30:23.946279-08:00","updated_at":"2025-12-26T19:46:21.785214-08:00","closed_at":"2025-12-26T19:46:21.785214-08:00","close_reason":"Implemented IncidentCard and IncidentList with Dexie hooks, date grouping, infinite scroll, and mobile UX improvements","dependencies":[{"issue_id":"reactivity-helper-hyk","depends_on_id":"reactivity-helper-axa","type":"blocks","created_at":"2025-12-25T22:30:57.261228-08:00","created_by":"daemon"},{"issue_id":"reactivity-helper-hyk","depends_on_id":"reactivity-helper-a46","type":"parent-child","created_at":"2025-12-25T22:34:52.410899-08:00","created_by":"daemon"}]}
{"id":"reactivity-helper-icu","title":"Fix TriggerGrid to show all 9 triggers","description":"## Problem\nTriggerGrid component (src/components/Reactivity/QuickLog/TriggerGrid.tsx) uses a hardcoded 6-trigger array instead of the TRIGGER_CONFIG constant. This means users cannot log incidents for:\n- Skateboard\n- Child  \n- Jogger\n\n## Root Cause\nLines 14-21 define a local `triggers` array with only 6 items. The TRIGGER_CONFIG in src/constants/triggers.ts already has all 9 triggers properly defined.\n\n## Solution\n1. Import TRIGGER_CONFIG from '../../../constants/triggers'\n2. Replace the hardcoded `triggers` array with a derived array from TRIGGER_CONFIG\n3. Update grid layout if needed (currently 3x2, should be 3x3)\n\n## Files to Modify\n- src/components/Reactivity/QuickLog/TriggerGrid.tsx\n\n## Acceptance Criteria\n- [ ] All 9 triggers display in grid\n- [ ] Grid shows 3 rows x 3 columns\n- [ ] Existing selection behavior unchanged\n- [ ] No duplicate type definitions","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-04T21:54:50.802338983-08:00","created_by":"mattc","updated_at":"2026-01-04T23:43:51.242434679-08:00","closed_at":"2026-01-04T23:43:51.242434679-08:00","close_reason":"Closed"}
{"id":"reactivity-helper-oqs","title":"TypeScript type definitions for all data models","description":"Create comprehensive TypeScript types for all data models as defined in DESIGN.md.\n\nFiles to create:\n- src/types/index.ts (barrel export)\n- src/types/reactivity.ts (Incident, TriggerType, DogBehavior, HandlerResponse)\n- src/types/separationAnxiety.ts (Departure, WeeklyTarget, all SA-related types)\n- src/types/medications.ts (MedicationConfig, DoseSchedule, MedicationEntry)\n- src/types/common.ts (Dog, UserSettings, NamedLocation)\n\nKey patterns:\n- Use nanoid for ID generation\n- ISO 8601 strings for timestamps\n- Strict union types for enums (TriggerType, DogBehavior, etc.)\n\nAcceptance criteria:\n- All types from DESIGN.md are implemented\n- Types are properly exported and usable throughout the app\n- No 'any' types used","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T22:30:20.777241-08:00","updated_at":"2025-12-25T23:01:42.8675-08:00","closed_at":"2025-12-25T23:01:42.8675-08:00","close_reason":"Closed","dependencies":[{"issue_id":"reactivity-helper-oqs","depends_on_id":"reactivity-helper-8ju","type":"blocks","created_at":"2025-12-25T22:30:53.749574-08:00","created_by":"daemon"},{"issue_id":"reactivity-helper-oqs","depends_on_id":"reactivity-helper-a46","type":"parent-child","created_at":"2025-12-25T22:34:49.837371-08:00","created_by":"daemon"}]}
{"id":"reactivity-helper-qlk","title":"Common components: Header and BottomNav","description":"Create reusable Header and BottomNav components per DESIGN.md navigation structure.\n\nComponents:\n1. src/components/common/Header.tsx\n   - Back arrow (‚Üê) for navigation to home\n   - Module name/title\n   - Settings gear icon\n   - Safe area padding (env(safe-area-inset-top))\n   - Mobile-first styling (min-h-11 touch targets)\n\n2. src/components/common/BottomNav.tsx\n   - 3 tabs: Log, History, Stats (icons + labels)\n   - Active tab highlighting\n   - Safe area padding (env(safe-area-inset-bottom))\n   - min-h-11 for touch targets\n\nStyling requirements:\n- Tailwind only\n- Mobile-first responsive design\n- Support for theme color (#4F46E5 indigo)\n\nAcceptance criteria:\n- Components render correctly\n- Navigation works between tabs\n- Safe areas respected on iOS notch devices","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T22:30:22.092506-08:00","updated_at":"2025-12-25T23:05:19.447969-08:00","closed_at":"2025-12-25T23:05:19.447969-08:00","close_reason":"Closed","dependencies":[{"issue_id":"reactivity-helper-qlk","depends_on_id":"reactivity-helper-8ju","type":"blocks","created_at":"2025-12-25T22:31:04.620522-08:00","created_by":"daemon"},{"issue_id":"reactivity-helper-qlk","depends_on_id":"reactivity-helper-a46","type":"parent-child","created_at":"2025-12-25T22:34:50.895956-08:00","created_by":"daemon"}]}
{"id":"reactivity-helper-x8m","title":"Fix iOS apple-mobile-web-app-capable meta tag","description":"iOS meta tag typo in index.html.\n\n## Problem\n\nLine 12 has Android-only meta tag:\n```html\n\u003cmeta name=\"mobile-web-app-capable\" content=\"yes\" /\u003e\n```\n\nShould be iOS-specific:\n```html\n\u003cmeta name=\"apple-mobile-web-app-capable\" content=\"yes\" /\u003e\n```\n\n## Note\n\nThe tag `mobile-web-app-capable` is for Android Chrome. The iOS equivalent is `apple-mobile-web-app-capable`. Since this is a PWA targeting both platforms, we should have BOTH:\n\n```html\n\u003c!-- Android Chrome --\u003e\n\u003cmeta name=\"mobile-web-app-capable\" content=\"yes\" /\u003e\n\u003c!-- iOS Safari --\u003e\n\u003cmeta name=\"apple-mobile-web-app-capable\" content=\"yes\" /\u003e\n```\n\n## Implementation\n\nIn `index.html`, change line 12 from:\n```html\n\u003cmeta name=\"mobile-web-app-capable\" content=\"yes\" /\u003e\n```\n\nTo:\n```html\n\u003cmeta name=\"mobile-web-app-capable\" content=\"yes\" /\u003e\n\u003cmeta name=\"apple-mobile-web-app-capable\" content=\"yes\" /\u003e\n```\n\n## Verification\n\n‚úÖ Other iOS meta tags already present:\n- `apple-mobile-web-app-status-bar-style` (line 13)\n- `apple-mobile-web-app-title` (line 14)\n- `apple-touch-icon` link (line 15)\n\n‚úÖ manifest.json link is handled by vite-plugin-pwa (injected at build time)\n\n## Files to modify\n1. `index.html` - add apple-mobile-web-app-capable meta tag after line 12","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-04T23:57:50.278102448-08:00","created_by":"mattc","updated_at":"2026-01-06T19:19:48.100031326-08:00"}
{"id":"reactivity-helper-xdj","title":"Wire up location auto-match in QuickLogScreen","description":"GPS coordinates are captured but not matched to named locations.\n\n## Current State\n\nQuickLogScreen.tsx:54-62 has commented-out location matching code:\n```typescript\n// TODO: Auto-match to named location using db helper\n// const namedLocation = await findNearestLocation(\n//   activeDogId,\n//   position.coords.latitude,\n//   position.coords.longitude\n// );\n// if (namedLocation) {\n//   incident.location.namedLocationId = namedLocation.id;\n// }\n```\n\n## Implementation\n\nUncomment and import the helper:\n\n```typescript\nimport { db, findNearestLocation } from '../../../db';\n\n// In handleLogIncident, after getting position (line 54-62):\ntry {\n  const position = await getCurrentPosition();\n  incident.location = {\n    lat: position.coords.latitude,\n    lng: position.coords.longitude,\n  };\n\n  // Auto-match to named location\n  const namedLocation = await findNearestLocation(\n    activeDogId,\n    position.coords.latitude,\n    position.coords.longitude\n  );\n  if (namedLocation) {\n    incident.location.namedLocationId = namedLocation.id;\n  }\n} catch (err) {\n  // Location failed or denied - continue without it\n  console.debug('Location not available:', err);\n}\n```\n\n## Key Decisions\n\n1. **Threshold**: Uses per-location `radiusMeters` from NamedLocation records (default 50m). Each saved location defines its own matching radius. No app-wide threshold needed.\n\n2. **No match fallback**: If no named location is within threshold, save incident with raw GPS only (lat/lng without namedLocationId). This is correct - don't force a match.\n\n3. **Auto-match without confirmation**: To maintain the 3-tap flow, matching happens automatically. Users don't need to confirm location matches. If they want to change it, they can edit the incident later (Phase 2 feature).\n\n4. **Helper already exists**: findNearestLocation is exported from src/db/index.ts:183-200. Just needs import.\n\n## Files to modify\n1. `src/components/Reactivity/QuickLog/QuickLogScreen.tsx` - uncomment lines 54-62, add import\n\n## Testing\n1. Create a named location with coordinates\n2. Log incident while within that location's radius\n3. Verify incident has namedLocationId set\n4. Log incident outside any location radius\n5. Verify incident has only lat/lng (no namedLocationId)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T23:57:45.236209005-08:00","created_by":"mattc","updated_at":"2026-01-06T19:19:00.963216416-08:00"}
